// Модуль для отображения дерева обновлений
const changelog = {
    data: null,

    // Инициализация - загрузка данных из JSON
    async init() {
        this.data = await Utils.loadJSON('data/changelog.json');
        if (!this.data) {
            console.error('Не удалось загрузить changelog.json');
        } else {
            // Проверка синхронизации версий
            this.checkVersionSync();
        }
    },

    // Проверка синхронизации между JSON и fallback
    checkVersionSync() {
        if (!this.data || !this.fallbackData) return;

        const jsonVersion = this.data.version;
        const fallbackVersion = this.fallbackData.version;

        if (jsonVersion !== fallbackVersion) {
            console.warn(
                `⚠️ ВНИМАНИЕ: Версии не синхронизированы!\n` +
                `JSON: ${jsonVersion}\n` +
                `Fallback: ${fallbackVersion}\n` +
                `Обновите fallbackData в changelog.js`
            );
        } else {
            console.log(`✅ Версии синхронизированы: ${jsonVersion}`);
        }
    },

    // Временные данные для работы без сервера (file:// протокол)
    // Эти данные используются только если не удалось загрузить JSON
    // ВАЖНО: При обновлении changelog.json нужно также обновить эти данные!
    fallbackData: {
        "version": "2.13.0",
        "updates": [
            {
                "version": "2.13.0",
                "date": "2025-12-04",
                "title": "Dark Glassmorphism: глобальный редизайн",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Glassmorphism дизайн всех модулей (backdrop-filter blur)",
                            "Градиентные фоны с цветовыми акцентами",
                            "Прозрачный sidebar с эффектом стекла",
                            "Кнопки ▲/▼ для счётчиков DEP/WITH/COMP в форме партнёра",
                            "Drag & drop стиль выбора файлов в импорте",
                            "Информативные карточки экспорта с иконками"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Обновлённая цветовая палитра статусов",
                            "CSS переменные для glassmorphism эффектов",
                            "Теги колонок в preview Excel экспорта",
                            "Компактные описания шаблонов Excel Reports",
                            "Увеличена ширина модального окна экспорта"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "css/home.css, team-info.css, partners.css",
                            "traffic-calculation.css, excel-reports.css",
                            "sync.css, documentation.css",
                            "partners/index.html, partners/js/partners.js",
                            "excel-reports/templates/*.js"
                        ]
                    }
                ]
            },
            {
                "version": "2.12.2",
                "date": "2025-12-04",
                "title": "Единый стиль скроллбаров",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Единый стиль скроллбаров во всех модулях",
                            "Квадратный дизайн скроллбаров (без закруглений)",
                            "Прозрачный фон скроллбара (адаптируется под любой фон)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "home.css, team-info.css, partners.css",
                            "traffic-calculation.css, excel-reports.css",
                            "sync.css, documentation.css, login.css"
                        ]
                    }
                ]
            },
            {
                "version": "2.12.1",
                "date": "2025-12-04",
                "title": "Улучшенное автообновление OAuth токена",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Обновление токена при возврате на вкладку браузера",
                            "Более частая проверка токена (каждые 30 сек)",
                            "Обновление за 10 минут до истечения (было 5 мин)"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Автоматический редирект на логин после 3 неудачных попыток обновления",
                            "Немедленный редирект если токен полностью истёк"
                        ]
                    }
                ]
            },
            {
                "version": "2.12.0",
                "date": "2025-12-04",
                "title": "Редизайн модулей: тёмная тема и улучшенный UX",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Тёмная тема модального окна «Настройки расчета % трафика»",
                            "Тёмная тема модального окна «Результаты расчета % трафика»",
                            "Выдвижная панель тикетов (drawer) на главной странице",
                            "Бейдж с количеством непрочитанных тикетов",
                            "Легенда уровней оценки в настройках трафика"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Компактный горизонтальный дизайн уровней трафика (хор/норм/плох/ужас)",
                            "Цветовая индикация уровней: зелёный, синий, жёлтый, красный",
                            "Адаптивная ширина модального окна настроек трафика",
                            "Современная пагинация партнёров со стрелками",
                            "Убраны спиннеры из числовых полей ввода"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Значения по умолчанию: 1/2/3/4 балла для уровней, 5 для множителя",
                            "Панель тикетов вынесена из основного контента в drawer"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Предупреждения консоли «No label associated with form field»"
                        ]
                    }
                ]
            },
            {
                "version": "2.11.0",
                "date": "2025-12-03",
                "title": "Безопасность: защита авторизации и данных",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "CSRF защита OAuth через криптографический state параметр",
                            "Валидация access token через Google API на сервере",
                            "Rate limiting: 30 запросов за 30 секунд на пользователя",
                            "XSS защита при отображении аватаров пользователей",
                            "SRI хеши для CDN скриптов (xlsx.js, SheetJS)"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "API запросы переведены на GET с URL параметрами (GAS теряет POST body при редиректе)",
                            "Авторизация использует accessToken вместо email для идентификации",
                            "Сессия унифицирована: 8 часов во всех модулях"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Устранена возможность подмены email в запросах к API",
                            "Устранена уязвимость XSS через picture URL в профиле"
                        ]
                    }
                ]
            },
            {
                "version": "2.10.0",
                "date": "2025-12-02",
                "title": "Новые шаблоны отчётов и улучшенная навигация",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Шаблон «Общий отчёт» — генерирует все таблицы T1-T9 за один проход",
                            "Шаблон «BTAG анализ» — обработка BTAG данных (T1, T2)",
                            "Шаблон «T9 Аналитика» — статистика по продуктам",
                            "Шаблон «Активные пользователи» — анализ активности (T4, T4.1)"
                        ]
                    }
                ]
            },
            {
                "version": "2.9.3",
                "date": "2025-12-02",
                "title": "Улучшение индикаторов загрузки",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Спиннер загрузки на странице Партнёров (вместо полноэкранного оверлея)",
                            "Спиннер загрузки на странице Расчёт трафика (шаг 1)"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Устранено дублирование STATUS сообщений от SharedWorker",
                            "Устранено мигание 'Нет партнёров для анализа' при загрузке страницы"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "GET_STATUS запрос из SyncManager (статус приходит автоматически при подключении)"
                        ]
                    }
                ]
            },
            {
                "version": "2.9.2",
                "date": "2025-12-02",
                "title": "Очистка кода синхронизации",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "sync-keeper.html - бесполезный iframe (SharedWorker работает без него)",
                            "Неиспользуемые методы backup очереди из SyncManager",
                            "mergeWithUnsynced() из CloudStorage - не использовался",
                            "getOperationKey(), addBatchToQueue(), getPendingCount() из SyncManager",
                            "clearQueue(), reset() - мёртвый код"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Уменьшен размер sync-manager.js на ~80 строк",
                            "Уменьшен размер cloud-storage.js на ~25 строк"
                        ]
                    }
                ]
            },
            {
                "version": "2.9.1",
                "date": "2025-12-02",
                "title": "Исправление дубликатов при синхронизации",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Устранена проблема с дубликатами партнёров при переключении вкладок во время синхронизации",
                            "Исправлено отображение счётчика оставшихся операций в индикаторе синхронизации",
                            "Устранены ложные 404 ошибки при загрузке версии из changelog.json"
                        ]
                    },
                    {
                        "category": "Новое",
                        "items": [
                            "SharedWorker для фоновой синхронизации между вкладками",
                            "SyncManager - клиент для управления синхронизацией",
                            "Автоматическая очистка дубликатов в облаке после завершения синхронизации",
                            "Проверка облачных данных перед восстановлением очереди из localStorage",
                            "Автообновление страницы после синхронизации (только при неактивности пользователя)",
                            "Отслеживание активности пользователя для предотвращения прерывания работы"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Добавлены флаги защиты от race condition при синхронизации",
                            "Улучшено определение пути к changelog.json на основе URL страницы"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "shared/sync-manager.js - НОВЫЙ: клиент SharedWorker с очисткой дубликатов",
                            "shared/sync-shared-worker.js - НОВЫЙ: SharedWorker для фоновой синхронизации",
                            "shared/cloud-storage.js - метод fetchPartnersFromCloud",
                            "shared/version.js - исправлен путь к changelog.json",
                            "traffic-calculation/js/storage.js - адаптирован для CloudStorage"
                        ]
                    }
                ]
            },
            {
                "version": "2.9.0",
                "date": "2025-12-01",
                "title": "Система обратной связи и тикетов",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Карточка 'Предложить улучшение' на главной странице для отправки идей, багов и пожеланий",
                            "Форма создания тикета с заголовком, описанием и загрузкой до 3 скриншотов",
                            "Секция 'Обратная связь' на главной для отображения тикетов",
                            "Система статусов: Новый, В работе, Нужна информация, Решено, Закрыт",
                            "Комментарии к тикетам от администратора и пользователей",
                            "Email-уведомления администратору о новых тикетах",
                            "Админ-панель для управления статусами и ответов на тикеты"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Пользователи видят только свои тикеты, администратор - все",
                            "Цветовая индикация статусов тикетов",
                            "Просмотр скриншотов в полном размере по клику"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "index.html - карточка тикетов, модальные окна создания и просмотра",
                            "css/home.css - стили для тикетов, форм, статусов",
                            "js/home.js - логика работы с тикетами",
                            "shared/cloud-storage.js - методы API для тикетов",
                            "Google Apps Script - функции getTickets, createTicket, updateTicketStatus, addTicketComment"
                        ]
                    }
                ]
            },
            {
                "version": "2.8.2",
                "date": "2025-12-01",
                "title": "Увеличение времени сессии и исправления документации",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Увеличено время жизни сессии с 1 часа до 8 часов"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлено название SimpleAIAdminka → AIAdminka в документации",
                            "Обновлена информация о времени сессии во всех разделах документации"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "shared/auth-guard.js - изменён таймаут сессии (28800000 мс)",
                            "documentation/index.html - исправлены названия и время сессии",
                            "documentation/README.md - исправлено название проекта"
                        ]
                    }
                ]
            },
            {
                "version": "2.8.1",
                "date": "2025-11-30",
                "title": "Синхронизация аватаров партнёров с Google Drive",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Загрузка аватаров партнёров в Google Drive (папка images)",
                            "Синхронизация изображений между устройствами через облако",
                            "Автоматическое удаление старого аватара при замене (без дубликатов)",
                            "Функция deleteImage в Apps Script для удаления файлов из Drive"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Аватары хранятся как avatarFileId (ссылка на Drive) вместо base64",
                            "При logout очищаются все данные пользователя (расширенный список)",
                            "Модальное окно обрезки теперь работает как предпросмотр"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Изображения сохраняются в оригинальном разрешении без сжатия",
                            "Визуальная обрезка через CSS object-fit: cover",
                            "uploadImage в Apps Script удаляет старый файл если передан oldFileId"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "partners/js/partners.js - загрузка/удаление аватаров через CloudStorage",
                            "shared/cloud-storage.js - методы uploadImage, deleteImage",
                            "shared/auth-guard.js - расширенная очистка localStorage при logout",
                            "Apps Script - добавлена функция deleteImage, улучшена uploadImage"
                        ]
                    }
                ]
            },
            {
                "version": "2.8.0",
                "date": "2025-11-30",
                "title": "Система авторизации и защита страниц",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Система контроля доступа с одобрением администратора",
                            "Приватная таблица AIAdminka_Admin для управления пользователями",
                            "Запрос доступа для новых пользователей с уведомлением администратора",
                            "Защита всех страниц через AuthGuard (редирект неавторизованных на login)",
                            "Кэширование партнёров в localStorage для кросс-модульной работы",
                            "Переработанная страница 'Настройки': профиль, статус облака, сессия, logout"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Вкладка 'Расчёт трафика' теперь берёт партнёров из кэша localStorage",
                            "При logout очищаются все кэшированные данные пользователя",
                            "AuthGuard автоматически проверяет авторизацию при загрузке страницы"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Синхронизация партнёров в localStorage при любом изменении",
                            "Кнопка 'Очистить кэш' в настройках для принудительной перезагрузки данных",
                            "Отображение времени истечения сессии в настройках"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "shared/auth-guard.js - автопроверка + очистка кэша при logout",
                            "login/js/login.js - checkAccess, requestAccess, очистка кэша",
                            "login/index.html - UI для запроса доступа и ожидания",
                            "login/css/login.css - стили access-denied, access-pending",
                            "sync/index.html - полный редизайн страницы настроек",
                            "sync/js/settings.js - новый модуль настроек",
                            "partners/js/partners.js - syncPartnersToLocalStorage()",
                            "Все HTML страницы - добавлен auth-guard.js"
                        ]
                    }
                ]
            },
            {
                "version": "2.7.0",
                "date": "2025-11-30",
                "title": "Управление методами и импорт/экспорт Excel",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Импорт данных партнёров через JSON или Excel с выбором формата",
                            "Экспорт данных партнёров через JSON или Excel с выбором формата",
                            "Выбор шаблона колонок для Excel импорта/экспорта",
                            "Скачивание примера Excel файла с правильной структурой колонок",
                            "Система управления методами: добавление, редактирование, удаление",
                            "Автоматическое добавление методов из импортируемых данных в список доступных методов"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Поле 'Метод' в форме партнёра заменено на выпадающий список",
                            "Добавлена кнопка настроек (шестерёнка) для управления методами"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Автоматическое обновление меню колонок после импорта данных",
                            "Уведомление о количестве добавленных методов при импорте"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "partners/index.html - модальные окна: методы, экспорт, импорт",
                            "partners/js/partners.js - функции управления методами и импорта/экспорта",
                            "partners/css/partners.css - стили модальных окон и элементов форм",
                            "partners/icons/settings.svg - добавлена иконка настроек"
                        ]
                    }
                ]
            },
            {
                "version": "2.6.3",
                "date": "2025-11-30",
                "title": "Унификация блока О разработке в сайдбаре",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Блок 'О разработке' отцентрирован как пункты меню выше",
                            "Добавлена иконка info в раскрытом сайдбаре (справа)",
                            "Отображение номера версии под текстом 'О разработке'",
                            "Унифицированы шрифты (TT Firs Neue, 14px) на всех 7 страницах"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Убраны лаги при открытии/закрытии сайдбара (удалены transitions и will-change)",
                            "Конфликт CSS-селекторов .version-number в документации",
                            "Добавлено поле id при импорте партнёров (partners.js)"
                        ]
                    }
                ]
            },
            {
                "version": "2.6.2",
                "date": "2025-11-30",
                "title": "Редизайн шагов Нарушения и % Времени работы",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Формула расчёта % трафика: теперь используется обратная пропорциональность (больше баллов = меньше трафика)",
                            "Дефолтные значения настроек: хорошо = 0 баллов, плохо = 10 баллов",
                            "Логика штрафных баллов: нарушения теперь добавляют баллы (а не вычитают)",
                            "Миграция старых настроек с отрицательными значениями на положительные"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Шаг 6 'Нарушения': новый layout - слева выбор субагента, справа grid с нарушениями",
                            "Шаг 4 '% Времени работы': аналогичный редизайн с карточками для ввода процентов",
                            "Оба шага занимают 100% высоты без скролла",
                            "Добавлена подсказка в модальном окне настроек расчёта % трафика",
                            "Динамический пример расчёта штрафных баллов в настройках"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Убраны стрелочки у полей ввода чисел (input spinners)",
                            "Иконки крестиков заменены на минусы в кнопках уменьшения",
                            "Укорочены placeholder'ы для узкой левой колонки"
                        ]
                    }
                ]
            },
            {
                "version": "2.6.1",
                "date": "2025-11-30",
                "title": "Интеграция Расчета трафика с вкладкой Партнеры",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Удалена вкладка 'Управление партнерами' из модуля 'Расчет трафика'",
                            "Данные партнёров теперь берутся из вкладки 'Партнеры' (единый источник данных)",
                            "Методы партнёров получаются автоматически из уникальных значений",
                            "Маппинг статусов: 'Открыт' → 'новый', 'Закрыт' → 'закрыт'",
                            "Вкладка 'Аналитика' теперь активна по умолчанию"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Устранено дублирование данных партнёров между модулями",
                            "Данные аналитики (back, cringe, автоотключения и др.) хранятся временно",
                            "При сбросе аналитики очищаются только временные данные, не затрагивая основную базу партнёров"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "Форма добавления партнёра в 'Расчет трафика'",
                            "Модальные окна: редактирование партнёра, управление методами, импорт партнёров",
                            "Локальное хранилище 'traffic-partners' (заменено на 'partners-data')"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "traffic-calculation/index.html - удалена вкладка и модальные окна (~150 строк)",
                            "traffic-calculation/js/storage.js - переписан для чтения из partners-data",
                            "traffic-calculation/js/traffic-calculation.js - обновлена инициализация и switchTab"
                        ]
                    }
                ]
            },
            {
                "version": "2.6.0",
                "date": "2025-11-30",
                "title": "Настройка колонок таблицы партнеров и упрощение статусов",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Система настройки колонок таблицы: кнопка фильтра в заголовке открывает меню",
                            "Выбор отображаемых колонок с чекбоксами (Фото, Метод, Субагент, ID Субагента, Статус)",
                            "Лимит максимум 5 видимых колонок (не считая DEP/WITH/COMP и стрелки)",
                            "Drag-and-drop перетаскивание для изменения порядка колонок",
                            "Кнопка 'Сбросить' для возврата к стандартной конфигурации",
                            "Счётчик видимых колонок в футере меню (например: 5/5)",
                            "Автоматическое добавление кастомных полей партнеров как колонок",
                            "Автоочистка неиспользуемых кастомных колонок (без данных)"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Заголовок таблицы генерируется динамически на основе конфигурации колонок",
                            "Статусы партнеров упрощены: было 5 (Работает, В отпуске, Командировка, Уволен, Болеет) → стало 2 (Открыт, Закрыт)",
                            "Статус по умолчанию изменён на 'Открыт'",
                            "Форма партнера: поля Субагент, ID Субагента, Метод вынесены в шапку",
                            "Карточка партнера: в шапке теперь отображаются Субагент и ID (вместо ФИО/Должность)",
                            "DEP/WITH/COMP вынесены в отдельную секцию формы (всегда видны)"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Фиксированная ширина колонок DEP/WITH/COMP (105px) и стрелки (40px)",
                            "Текстовые колонки с ellipsis для длинных данных (max-width)",
                            "Заголовки колонок отображаются полностью (без обрезки)",
                            "Переработан dropdown выбора статуса: белый фон, тень, скруглённые углы",
                            "Hover эффекты для опций статуса и кликабельной области badge",
                            "Анимация стрелки статуса: → при закрытии, ↓ при открытии",
                            "Мгновенное обновление таблицы при изменении статуса в карточке",
                            "Конфигурация колонок сохраняется в localStorage"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "partners/js/partners.js - система колонок (+300 строк), статусы, форма",
                            "partners/index.html - динамический заголовок, меню колонок, обновлённая форма",
                            "partners/css/partners.css - стили меню колонок, ширины колонок (+180 строк)"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.14",
                "date": "2025-11-29",
                "title": "Переименование пунктов меню",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Главная страница → Главная",
                            "Excel отчеты → Отчеты",
                            "Team Info → Сотрудники",
                            "Синхронизация → Настройки"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Изменён порядок в сайдбаре: Партнеры теперь перед Документацией",
                            "Обновлены названия на главной странице (сетка модулей)",
                            "Обновлены названия иконок рабочего стола в main.js"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "7 HTML файлов - обновлены названия в сайдбаре",
                            "index.html - обновлена сетка модулей",
                            "js/main.js - обновлены названия иконок"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.13",
                "date": "2025-11-28",
                "title": "Исправление переноса текста в сайдбаре",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлен перенос текста пунктов меню на 2 строки на страницах Excel Отчеты и Синхронизация",
                            "Добавлены недостающие CSS свойства white-space: nowrap и overflow: hidden"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "excel-reports/css/excel-reports.css - унифицированы стили .menu-item",
                            "sync/css/sync.css - унифицированы стили .menu-item"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.12",
                "date": "2025-11-28",
                "title": "Унификация размеров сайдбара",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлены размеры сайдбара на странице Расчет трафика (были меньше чем на других страницах)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "traffic-calculation/css/traffic-calculation.css - унифицированы стили сайдбара"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.11",
                "date": "2025-11-28",
                "title": "Исправление лагов сайдбара и унификация",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлен лаг анимации сайдбара при переходе между страницами (сайдбар больше не \"мелькает\")",
                            "Добавлен CSS класс .no-transition для блокировки анимации при инициализации"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Унифицирован сайдбар на всех 7 страницах проекта",
                            "Унифицирован inline скрипт инициализации сайдбара с двойным requestAnimationFrame",
                            "Унифицирован текст version-info (\"Загрузка...\" на всех страницах)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "7 HTML файлов - обновлён скрипт инициализации сайдбара",
                            "7 CSS файлов - добавлен класс .no-transition"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.10",
                "date": "2025-11-28",
                "title": "Очистка кода страницы Партнеры",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалены дублирующиеся CSS стили: .card-header, .card-team-header, .card-team-name, .card-partner-info, .card-info-section, .card-name, .card-position",
                            "Удалён неиспользуемый CSS селектор .sort-header svg (в HTML используется img)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "partners/css/partners.css - удалено ~58 строк дублирующегося кода"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.9",
                "date": "2025-11-28",
                "title": "Очистка кода страницы Расчет трафика",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалена неиспользуемая функция parseQualityData (пустая, с комментарием 'больше не используется')",
                            "Удалены функции showDetailedReport и closeDetailedReport (работали с несуществующим модальным окном)",
                            "Удалён неиспользуемый CSS класс .optional-badge",
                            "Удалены дублирующиеся объявления свойств из середины объекта trafficCalc"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлена неиспользуемая переменная methodIndex в forEach",
                            "Заменён устаревший метод substr() на slice()"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Реорганизованы свойства объекта trafficCalc - все перенесены в начало",
                            "Добавлены недостающие объявления свойств: currentSelectedPartnerId6, allPartnersListForStep6"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "traffic-calculation/js/traffic-calculation.js - удалено ~100 строк",
                            "traffic-calculation/css/traffic-calculation.css - удалено 10 строк"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.8",
                "date": "2025-11-28",
                "title": "Очистка кода страницы Team Info",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалён неиспользуемый файл team-info-modern.css (XP-стили, не подключён)",
                            "Удалён файл team-info.css.backup",
                            "Удалён файл export-manager.js (функции не использовались, ссылки на несуществующий DOM)",
                            "Удалено неиспользуемое модальное окно employeeModal (~105 строк HTML)",
                            "Удалены методы showEditModal(), saveEmployee(), closeEmployeeModal() (заменены правой панелью)",
                            "Удалён неиспользуемый CSS класс .employee-card-panel",
                            "Удалена неактуальная ссылка на formStatus в attachFormChangeListeners()",
                            "Удалено устаревшее поле grade из миграции данных"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "team-info/css/team-info-modern.css - удалён",
                            "team-info/css/team-info.css.backup - удалён",
                            "team-info/js/export-manager.js - удалён",
                            "team-info/index.html - удалено ~105 строк",
                            "team-info/js/team-info.js - удалено ~120 строк",
                            "team-info/css/team-info.css - удалено 4 строки",
                            "team-info/js/storage.js - удалена 1 строка"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.7",
                "date": "2025-11-28",
                "title": "Очистка кода страницы Excel отчеты",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалена избыточная строка window.TEMPLATES = TEMPLATES (TEMPLATES уже глобальная константа)",
                            "Удалён отладочный console.log из templates-loader.js",
                            "Удалён неиспользуемый массив logs из logger.js (данные сохранялись, но не использовались)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "excel-reports/templates/templates-loader.js - удалено 5 строк",
                            "excel-reports/js/logger.js - удалено 2 строки"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.6",
                "date": "2025-11-28",
                "title": "Очистка кода Главной страницы",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалён дублирующийся код загрузки версии из home.js (loadVersion(), init()) - используется shared/version.js",
                            "Удалён неиспользуемый CSS класс .module-card.disabled",
                            "Удалено дублирующееся CSS правило .sidebar.collapsed .menu-separator"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Placeholder версии в HTML заменён на 'Загрузка...' (версия загружается динамически)"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "js/home.js - удалено ~15 строк дублирующего кода",
                            "css/home.css - удалено 2 неиспользуемых CSS правила",
                            "index.html - актуализирован placeholder версии"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.5",
                "date": "2025-11-28",
                "title": "Очистка кода модуля Документация",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалён неактуальный код Lucide (data-lucide, lucide.createIcons()) - Lucide не используется с v2.4.2",
                            "Удалена дублирующаяся функция formatDate() - используется Utils.formatDate()"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Иконки категорий в истории обновлений заменены на текстовые символы (+, ✓, ⚡, −, ✎)",
                            "Объединены объекты icons и colors в единый categoryStyles"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Добавлены недостающие категории: Безопасность, Бэкенд, Файлы"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "documentation/js/changelog.js - очистка ~15 строк мёртвого кода"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.4",
                "date": "2025-11-28",
                "title": "Редизайн страницы Документация",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Полностью переработанная страница 'Документация' в едином стиле с другими модулями",
                            "Боковое сворачиваемое меню навигации (сайдбар)",
                            "Панель содержания (TOC) слева с подсветкой активного раздела",
                            "Кнопка 'История обновлений' перенесена в шапку"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Новый минималистичный тёмный дизайн с шрифтом TT Firs Neue",
                            "Цветовая схема: тёмный фон (#1a1a1a, #2e2e2e), светлый контент (#f2f2f2)",
                            "Жёлтый акцентный цвет (#fdbe2f) для активных элементов",
                            "Плавная прокрутка к разделам при клике на оглавление",
                            "Адаптивный дизайн для мобильных устройств"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "documentation/index.html - новая структура с sidebar",
                            "documentation/css/documentation.css - полностью переписан",
                            "documentation/icons/ - добавлены SVG иконки",
                            "documentation/fonts/ - добавлены шрифты TT Firs Neue"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.3",
                "date": "2025-11-28",
                "title": "Исправление OAuth и очистка кода Синхронизации",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлена авторизация Google OAuth на GitHub Pages",
                            "Решена проблема CSP (Content Security Policy) блокирующая запросы к googleapis.com",
                            "callback.html теперь только сохраняет токен, sync.js получает данные пользователя",
                            "Добавлен script.googleusercontent.com в CSP для работы Google Apps Script"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалено неиспользуемое поле 'URL Google Apps Script' (URL захардкожен)",
                            "Удалена устаревшая секция 'Как настроить?' с неактуальными инструкциями",
                            "Удалён неиспользуемый resultModal для ввода результата",
                            "Очищены неиспользуемые CSS стили: .config-field, .help-list, .result-textarea"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "sync/callback.html - упрощён, убран CSP и fetch",
                            "sync/js/sync.js - добавлен fetchUserInfo(), очищен мёртвый код",
                            "sync/index.html - удалены неиспользуемые элементы",
                            "sync/css/sync.css - удалены неиспользуемые стили (~40 строк)"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.2",
                "date": "2025-11-28",
                "title": "Редизайн страницы Расчет трафика",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Полностью переработанная страница 'Расчет трафика' в едином стиле с главной, Team Info, Партнёрами и Синхронизацией",
                            "Боковое сворачиваемое меню навигации (сайдбар)",
                            "Индикатор шагов (steps indicator) в новом тёмном дизайне",
                            "Современные вкладки (tabs) для переключения между разделами",
                            "Карточки статистики в отчёте"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Удалён старый интерфейс Windows XP",
                            "Новый минималистичный тёмный дизайн с шрифтом TT Firs Neue",
                            "Цветовая схема: тёмный фон (#1a1a1a, #2e2e2e), светлый контент (#f2f2f2)",
                            "Жёлтый акцентный цвет (#fdbe2f) для активных элементов",
                            "Удалены все зависимости от Lucide CDN - используются локальные SVG иконки"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "Переписан css/traffic-calculation.css - стили в едином дизайне",
                            "Обновлён index.html - новая структура с сайдбаром",
                            "Обновлён js/traffic-calculation.js - добавлен toggleSidebar(), убраны lucide",
                            "Добавлена папка fonts/ со шрифтами TT Firs Neue",
                            "Добавлены SVG иконки в папку icons/"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.1",
                "date": "2025-11-28",
                "title": "Редизайн страницы Excel отчеты",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Полностью переработанная страница 'Excel отчеты' в едином стиле с Team Info, Партнёрами и Синхронизацией",
                            "Боковое сворачиваемое меню навигации (сайдбар)",
                            "Индикатор шагов (steps indicator) вверху страницы",
                            "Drag & drop зона для загрузки файлов",
                            "Правая панель с журналом операций в новом стиле"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Удалён старый интерфейс Windows XP",
                            "Новый минималистичный тёмный дизайн с шрифтом TT Firs Neue",
                            "Карточки шаблонов вместо старых XP-кнопок",
                            "Современные кнопки 'Назад/Далее/Обработать/Скачать'"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "Обновлён index.html - новая структура с сайдбаром",
                            "Переписан css/excel-reports.css - стили в едином дизайне",
                            "Обновлён js/excel-reports.js - объект excelApp с toggleSidebar()",
                            "Обновлён js/logger.js - новый формат логов",
                            "Добавлена папка fonts/ со шрифтами TT Firs Neue",
                            "Добавлены иконки в папку icons/"
                        ]
                    }
                ]
            },
            {
                "version": "2.5.0",
                "date": "2025-11-28",
                "title": "Редизайн главной страницы",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Полностью переработанная главная страница в едином стиле с Team Info, Партнерами и Синхронизацией",
                            "Боковое сворачиваемое меню навигации (сайдбар) как на других страницах",
                            "Сетка модулей 3x2 с карточками: иконка, название и описание",
                            "Анимация при наведении на карточки модулей",
                            "Автозагрузка версии из changelog.json"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Удалён старый интерфейс Windows XP с рабочим столом и панелью задач",
                            "Создан новый минималистичный тёмный дизайн",
                            "Шрифт TT Firs Neue, жёлтый акцент (#fdbe2f)",
                            "Модальное окно 'О разработке' открывается из сайдбара"
                        ]
                    },
                    {
                        "category": "Файлы",
                        "items": [
                            "Создан css/home.css - стили главной страницы",
                            "Создан js/home.js - логика главной страницы",
                            "Создана папка icons/ с SVG иконками для главной",
                            "Обновлён index.html - новая структура"
                        ]
                    }
                ]
            },
            {
                "version": "2.4.2",
                "date": "2025-11-28",
                "title": "Локальные иконки вместо Lucide CDN",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Полный переход с внешней библиотеки Lucide (unpkg.com) на локальные SVG иконки",
                            "Создана папка shared/icons/ с 32 SVG иконками",
                            "Создан shared/icons.js - локальная система иконок с API совместимым с Lucide",
                            "Удалены все внешние ссылки на unpkg.com из HTML файлов",
                            "Обновлена CSP (Content Security Policy) - убран unpkg.com из script-src"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлена ошибка CSP: Refused to connect to unpkg.com/lucide",
                            "Проект теперь полностью автономен - не требует внешних CDN для иконок"
                        ]
                    }
                ]
            },
            {
                "version": "2.4.1",
                "date": "2025-11-28",
                "title": "Исправления безопасности",
                "changes": [
                    {
                        "category": "Безопасность",
                        "items": [
                            "Исправлена XSS уязвимость через avatar URL в модулях Partners и Team Info",
                            "Добавлена валидация URL изображений (только data:image/, http://, https://)",
                            "Заменены inline onclick на addEventListener для предотвращения XSS инъекций",
                            "Добавлены Content-Security-Policy заголовки во все HTML файлы",
                            "Безопасное создание DOM элементов вместо innerHTML с пользовательскими данными"
                        ]
                    }
                ]
            },
            {
                "version": "2.4.0",
                "date": "2025-11-28",
                "title": "GitHub Pages и облачная синхронизация",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Проект теперь доступен на GitHub Pages: https://workzick.github.io/AIAdminka_Page/",
                            "Модуль 'Синхронизация' с облачным хранением данных через Google Sheets",
                            "OAuth авторизация через Google (автоматическое получение email и имени)",
                            "Система контроля доступа: запрос → одобрение администратором → доступ",
                            "Экспорт данных в облако (Google Sheets)",
                            "Импорт данных от коллег с разграничением прав",
                            "Настройки доступа: выбор кому видны ваши данные"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Кнопка 'Войти через Google' для авторизации",
                            "Кнопка 'Запросить доступ' для новых пользователей",
                            "Кнопка 'Проверить доступ' с защитой от спама (10 сек)",
                            "Журнал операций с логированием всех действий",
                            "Статусы подключения: Не авторизован → Ожидание → Подключено"
                        ]
                    },
                    {
                        "category": "Бэкенд",
                        "items": [
                            "Google Apps Script для обработки запросов",
                            "Лист 'Approved' для управления доступом пользователей",
                            "Лист 'Requests' для запросов на доступ",
                            "Лист 'Data' для хранения данных пользователей",
                            "Лист 'Access' для настройки прав импорта между пользователями"
                        ]
                    }
                ]
            },
            {
                "version": "2.3.0",
                "date": "2025-11-26",
                "title": "Полный редизайн модуля Партнеры",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Полностью переработанный интерфейс модуля 'Партнеры' в стиле Team Info",
                            "Новая структура таблицы: DEP|WITH|COMP, Фото, Ф.И.О., Метод, Субагент, ID Субагента, Статус",
                            "Счётчики DEP/WITH/COMP редактируются в карточке партнера",
                            "Система шаблонов для настройки полей партнеров (как в Team Info)",
                            "Карточка партнера в правой панели с полной информацией",
                            "Загрузка аватара с обрезкой изображения",
                            "5 статусов партнера: Работает, В отпуске, Командировка, Уволен, Болеет",
                            "Dropdown выбор статуса прямо в карточке",
                            "Экспорт/импорт списка партнеров в JSON"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Анимация стрелки при открытии/закрытии карточки (0° → 180°)",
                            "Заштрихованные поля при создании шаблона (disabled preview)",
                            "Удалена кнопка 'Удалить' из формы редактирования (остаётся в карточке)",
                            "Все SVG иконки стандартизированы (viewBox 0 0 24 24)",
                            "Иконки фильтров в таблице белого цвета (16x16)"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Боковое меню с навигацией по всем модулям",
                            "Статистика партнеров в правой панели",
                            "Поиск и сортировка по любому столбцу",
                            "Toggle карточки: повторный клик закрывает"
                        ]
                    }
                ]
            },
            {
                "version": "2.2.1",
                "date": "2025-11-26",
                "title": "Комментарии в Excel для описания нарушений",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Экспорт детального отчета в Excel теперь включает комментарии к ячейкам 'Другие нарушения' с описанием"
                        ]
                    }
                ]
            },
            {
                "version": "2.2.0",
                "date": "2025-11-26",
                "title": "Улучшения калькулятора трафика и аналитики нарушений",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Расчет % трафика теперь производится отдельно по каждому методу (100% на метод)",
                            "Группировка результатов по методам с визуальными заголовками",
                            "Текстовое поле для описания в пункте 'Другие нарушения'",
                            "Tooltip в итоговой таблице для отображения описания нарушений при наведении",
                            "Упрощенная настройка 'Другие нарушения' - баллы за каждое нарушение (умножаются на количество)"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Шаг 6 (Нарушения) теперь необязательный",
                            "Компактный дизайн модального окна 'Настройки расчета % трафика'",
                            "Карточки уровней теперь в 4 колонки для лучшей читаемости",
                            "Сортировка партнеров внутри метода по проценту (от большего к меньшему)"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлена ошибка импорта партнеров (this.loadPartners is not a function)"
                        ]
                    }
                ]
            },
            {
                "version": "2.1.0",
                "date": "2025-11-26",
                "title": "Система шаблонов и улучшения навигации Team Info",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Система шаблонов для настройки полей сотрудников: создание, редактирование, удаление и переименование шаблонов",
                            "Выбор основного (default) шаблона, который автоматически применяется при добавлении сотрудника",
                            "Возможность добавления неограниченного количества настраиваемых полей через шаблоны",
                            "5 типов полей в шаблонах: Текст, Email, Телефон, Дата, Текстовая область",
                            "Новая иконка 'download_photo_placeholder.svg' для пустого аватара в форме",
                            "Иконка 'add.svg' для кнопки добавления полей в шаблоне",
                            "Система навигации с историей: переход между статистикой, карточкой и формой с сохранением контекста",
                            "Автосохранение при переключении между формой и карточкой",
                            "Placeholder для загрузки фото в форме редактирования"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Toggle-поведение карточки сотрудника: повторный клик закрывает карточку и возвращает к статистике",
                            "Улучшена навигация: при закрытии формы возвращает к предыдущему состоянию (карточка или статистика)",
                            "Автоматическая подстройка высоты textarea для комментария (до 200px)",
                            "Визуальное отключение (disabled state) полей ФИО, должности и статуса при редактировании шаблона",
                            "Визуальное отключение загрузки аватара при создании/редактировании шаблона",
                            "Кнопка сохранения теперь с иконкой и динамическим текстом ('Добавить сотрудника' / 'Сохранить' / 'Сохранить шаблон')",
                            "Обновлен дизайн кнопок формы с иконками (галочка для сохранения, крестик для отмены)",
                            "Шаблоны сохраняются в localStorage и доступны для всех сотрудников",
                            "При применении шаблона скрываются стандартные поля и отображаются только поля из шаблона",
                            "Автоматическое удаление динамических полей при сбросе формы",
                            "Улучшена логика сохранения: customFields теперь сохраняются отдельно от predefinedFields"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Селектор шаблонов в правом верхнем углу формы при добавлении сотрудника",
                            "Опции селектора: выбор шаблона, добавление, редактирование, переименование, удаление",
                            "Редактор шаблонов с возможностью добавления полей разных типов",
                            "Визуальные индикаторы основного шаблона в селекторе (метка 'основной')",
                            "Диалоги выбора шаблона для редактирования/переименования/удаления с нумерованным списком",
                            "Подтверждения при удалении шаблонов",
                            "Placeholder-иконка загрузки фото вместо пустого серого квадрата"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлена работа формы: теперь правильно переключается между режимами добавления/редактирования/шаблона",
                            "Исправлено удаление динамических полей при переключении шаблонов",
                            "Исправлена логика отображения селектора шаблонов (только при добавлении, скрыт при редактировании)",
                            "Исправлена обработка customFields при сохранении сотрудника",
                            "Устранена проблема с потерей данных при навигации между формой и карточкой"
                        ]
                    }
                ]
            },
            {
                "version": "2.0.3",
                "date": "2025-11-26",
                "title": "Переход на локальные SVG иконки и редизайн статистики Team Info",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Добавлена папка icons/ с 20 локальными SVG-иконками для полной автономности",
                            "Все иконки интерфейса теперь работают без подключения к интернету",
                            "Редизайн панели статистики с новым стилем отображения"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "Удалена зависимость от внешней библиотеки Lucide Icons",
                            "Все <svg> элементы заменены на <img src='icons/...'>",
                            "Удален скрипт инициализации lucide.createIcons()"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Кнопка 'назад' в сайдбаре перемещена вправо с анимацией поворота на 180° при сворачивании",
                            "Статистика: общее количество сотрудников вынесено в отдельный белый блок",
                            "Статистика по статусам переведена в сетку 2 колонки (grid)",
                            "Фон статистики изменен на #f2f2f2 для лучшей визуальной иерархии",
                            "Улучшена типографика статистики: уменьшены размеры шрифтов, оптимизированы отступы",
                            "Статус-бейджи в статистике растянуты на всю ширину ячейки",
                            "Dropdown статусов упрощен: убрана белая рамка и тень, прозрачный фон",
                            "Hover эффект dropdown изменен на opacity вместо смены фона",
                            "Убрана иконка dropdown из ячейки статуса в таблице",
                            "Добавлена анимация поворота стрелки в выбранной строке таблицы (rotate 180deg)",
                            "Добавлены белые фильтры для иконок кнопок (filter: brightness(0) invert(1))",
                            "Иконка поиска теперь с полупрозрачностью для лучшей визуальной иерархии"
                        ]
                    }
                ]
            },
            {
                "version": "2.0.2",
                "date": "2025-11-14",
                "title": "Улучшения UX поиска и выравнивания Team Info",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Убрана белая обводка у поля поиска сотрудников",
                            "Убрана обводка при фокусе на поле поиска для более чистого внешнего вида",
                            "Кнопки 'Экспорт списка' и 'Импорт списка' теперь выровнены по правому краю правой панели"
                        ]
                    }
                ]
            },
            {
                "version": "2.0.1",
                "date": "2025-11-14",
                "title": "Улучшения дизайна и исправление ошибок Team Info",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Все заголовки блоков (section-header, stats-team-header, card-team-header, form-team-header) теперь имеют единую высоту 60px",
                            "Добавлено закругление верхних углов (8px) для всех заголовочных блоков",
                            "Добавлено закругление нижних углов (8px) для футеров и контента",
                            "Переработана структура закруглений: родительские контейнеры прозрачные, закругления контролируются дочерними элементами",
                            "Улучшена визуальная целостность интерфейса с единообразными закруглениями"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Убраны захардкоженные значения статистики из HTML (21, 19, 0, 1, 1, 2) - теперь используется 0 с динамическим обновлением",
                            "Исправлено мигание сайдбара при перезагрузке страницы - добавлен inline-скрипт для мгновенного применения состояния",
                            "Добавлена автоматическая инициализация teamInfo.init() при событии DOMContentLoaded",
                            "Исправлено обновление названия команды во всех местах интерфейса (статистика, карточка, форма)",
                            "Устранены белые пятна в углах заголовков благодаря правильной структуре закруглений"
                        ]
                    }
                ]
            },
            {
                "version": "1.4.2",
                "date": "2025-11-09",
                "title": "Обновления рабочего стола: удаление декоративных иконок и добавление информации о проекте",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Добавлена красная иконка 'О разработке' в центре рабочего стола",
                            "Модальное окно с информацией о проекте в стиле Windows XP:",
                            "  - Автор проекта: Vadim P",
                            "  - Reddy ID для связи: 62219492522",
                            "  - Кликабельная ссылка на чат с актуальной версией",
                            "Анимация появления модального окна",
                            "Красный градиентный фон для иконки с белой иконкой info"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Удалены декоративные иконки 'Мой компьютер' и 'Корзина'",
                            "Рабочий стол теперь содержит только функциональные модули",
                            "Обновлена документация с информацией о специальной иконке 'О разработке'"
                        ]
                    }
                ]
            },
            {
                "version": "1.4.1",
                "date": "2025-11-09",
                "title": "Улучшения модуля 'Команда': экспорт/импорт и копирование карточек",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Добавлена функция копирования карточек сотрудников с двумя режимами",
                            "Кнопка копирования (📋) на каждой карточке сотрудника",
                            "Модальное окно выбора типа копирования"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Экспорт в TXT теперь корректно выводит структуру данных сотрудников",
                            "Выборочный экспорт обновлен под новую структуру",
                            "Импорт данных поддерживает миграцию старых файлов"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Экспорт всех записей в TXT более информативен",
                            "Улучшена визуализация кнопки копирования",
                            "Копирование предзаполненных полей работает корректно"
                        ]
                    }
                ]
            },
            {
                "version": "1.4.0",
                "date": "2025-11-09",
                "title": "Масштабный рефакторинг архитектуры проекта",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Создан shared/storage.js - единый модуль для работы с localStorage",
                            "Создан shared/utils.js - библиотека общих утилит",
                            "Вынесены данные changelog в JSON файл"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "376 строк JS перенесено из index.html в js/main.js",
                            "Добавлены JSDoc комментарии к ключевым функциям",
                            "Улучшена обработка ошибок localStorage"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Удалены ссылки на несуществующий lucide-icons.css",
                            "Исправлена двойная инициализация в logger.js"
                        ]
                    }
                ]
            },
            {
                "version": "1.3.4",
                "date": "2025-11-09",
                "title": "Новый модуль: Партнеры",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Создан модуль 'Партнеры' для управления партнерской информацией",
                            "Таблица партнеров с тремя полями: Метод, Субагент, ID Субагента",
                            "Добавление новых партнеров через модальное окно",
                            "Редактирование существующих партнеров",
                            "Удаление партнеров с подтверждением",
                            "Пустое состояние с кнопкой быстрого добавления первого партнера",
                            "Автоматическое сохранение в localStorage",
                            "Интеграция в главное меню и рабочий стол"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Табличное отображение всех партнеров",
                            "Кнопки действий (редактировать, удалить) в каждой строке",
                            "Модальное окно для ввода данных",
                            "Стилизация в едином стиле Windows XP"
                        ]
                    }
                ]
            },
            {
                "version": "1.3.3",
                "date": "2025-11-09",
                "title": "Унификация стилей кнопок на вкладке 'Расчет трафика'",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Все кнопки 'Сбросить всё' на шагах аналитики теперь красного цвета (btn-danger)",
                            "Добавлены единообразные стили для кнопок с градиентами и эффектами hover/active",
                            "Кнопки 'Сбросить' внутри форм теперь меньшего размера (btn-small)",
                            "Добавлен класс btn-warning для оранжевых кнопок (Импорт)",
                            "Добавлен класс btn-danger для красных кнопок (Сбросить всё)",
                            "Все кнопки на вкладке 'Расчет трафика' теперь имеют единообразный стиль"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Некорректное отображение кнопок 'Сбросить всё' на шагах 1, 4 и 6",
                            "Отсутствующие стили для кнопок предупреждения и опасности",
                            "Несоответствие размеров и отступов кнопок"
                        ]
                    }
                ]
            },
            {
                "version": "1.3.2",
                "date": "2025-11-09",
                "title": "Импорт/экспорт партнеров и переработка вкладки Отчет",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Экспорт списка партнеров в JSON (только базовые данные, без аналитики)",
                            "Импорт списка партнеров из JSON с умным слиянием данных",
                            "Предпросмотр файла перед импортом партнеров",
                            "Автоматическое сохранение данных аналитики при импорте существующих партнеров",
                            "Защита от перезаписи данных аналитики при импорте",
                            "Экспорт детального отчета в Excel (.xlsx) с 23 колонками"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Вкладка 'Отчет': краткая таблица заменена на полную детальную таблицу",
                            "Детальная таблица теперь отображается сразу на странице (без модального окна)",
                            "Кнопка 'Подробнее' удалена, вместо неё 'Экспорт в Excel'",
                            "После нажатия 'Завершить' автоматически переходит на вкладку 'Отчет' и формирует отчет",
                            "Переименовано 'Краткая таблица' → 'Детальный отчет'"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Импорт партнеров работает даже при изменении структуры данных",
                            "Исключено поле 'prepaymentDisable' из списка экспортируемых данных",
                            "Все 23 колонки детального отчета доступны сразу на странице",
                            "Файлы экспорта с датой в названии для удобства",
                            "Предупреждения о замене данных при импорте"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "Модальное окно детального отчета",
                            "Кнопка 'Подробнее' на вкладке Отчет"
                        ]
                    }
                ]
            },
            {
                "version": "1.3.1",
                "date": "2025-11-09",
                "title": "Улучшение интерфейса шагов 4 и 6, добавление функций сброса",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Двухколоночный макет для шагов 4 и 6: слева - форма с данными, справа - выбор субагента",
                            "Кнопка 'Сбросить' для сброса данных текущего субагента (шаги 4 и 6)",
                            "Кнопка 'Сбросить всё' для сброса данных всех выбранных субагентов (шаги 4 и 6)",
                            "Подтверждение перед сбросом данных",
                            "Уведомление о количестве субагентов с очищенными данными"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Увеличен размер списка выбора субагентов с 5 до 10 видимых элементов",
                            "Единообразный стиль полей поиска и выбора на обеих вкладках",
                            "Компактное расположение элементов для лучшей читаемости",
                            "Адаптивная верстка - на мобильных устройствах блоки располагаются вертикально",
                            "Автоматическое обновление отображения при сбросе данных"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Разделены функции сброса для текущего субагента и всех субагентов",
                            "Переработана структура HTML для оптимальной компоновки"
                        ]
                    }
                ]
            },
            {
                "version": "1.3.0",
                "date": "2025-11-09",
                "title": "Реорганизация шагов аналитики и новые возможности навигации",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Шаги 4 и 5 поменяны местами: теперь шаг 4 - Ручные данные, шаг 5 - Процентовки",
                            "Логичный порядок: сначала ручной ввод данных, потом загрузка процентовок",
                            "Количество параметров оценки уменьшено с 19 до 18 (удалено 'Отключение по предоплате')"
                        ]
                    },
                    {
                        "category": "Новое",
                        "items": [
                            "Кликабельные индикаторы шагов - переход на любой шаг одним кликом",
                            "Визуальное отслеживание прогресса с зелеными галочками для завершенных шагов",
                            "Возможность редактирования данных после завершения аналитики",
                            "Кнопка 'Сбросить всё' для начала нового анализа с подтверждением",
                            "Автосохранение данных текущего партнера при навигации между шагами",
                            "Hover-эффекты на индикаторе шагов для лучшего UX"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Данные больше не очищаются после нажатия 'Завершить'",
                            "Автоматическое сохранение ручных данных при переключении субагентов",
                            "Улучшенная валидация: данные восстанавливаются из основного хранилища",
                            "Подсказка о возможности редактирования после завершения",
                            "Статусы шагов сохраняются и обновляются в реальном времени"
                        ]
                    },
                    {
                        "category": "Удалено",
                        "items": [
                            "Поле 'Отключение по предоплате' из ручных данных (шаг 4)",
                            "Соответствующая колонка из детального отчета"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Баг с пропаданием ручных данных при переключении между субагентами",
                            "Проблема с несохранением данных последнего субагента перед завершением"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.13",
                "date": "2025-11-05",
                "title": "Упрощение настроек калькулятора",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Поле 'Дней с момента добавления' из настроек калькулятора трафика"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Количество параметров для оценки уменьшено с 20 до 19"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.12",
                "date": "2025-11-05",
                "title": "Калькулятор % трафика",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Кнопка 'Рассчитать % трафика' на вкладке Отчет",
                            "Система оценки из 4 уровней: Хороший, Нормальный, Плохой, Ужасный",
                            "20 параметров для оценки (все числовые колонки детального отчета)",
                            "Настройка диапазонов значений для каждого уровня",
                            "Настройка баллов (можно указать минусовые значения)",
                            "Автоматический расчет дней с момента добавления партнера",
                            "Таблица результатов с колонками: Метод, Субагент, ID, Хороший, Нормальный, Плохой, Ужасный, Всего",
                            "Сохранение настроек в localStorage",
                            "Экспорт результатов в Excel"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Модальное окно настроек (95% экрана)",
                            "Карточки с цветовой кодировкой для каждого уровня",
                            "Зеленые, синие, оранжевые и красные цвета для уровней",
                            "Цветное отображение баллов в таблице результатов"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.11",
                "date": "2025-11-05",
                "title": "Улучшение отображения детального отчета",
                "changes": [
                    {
                        "category": "Улучшено",
                        "items": [
                            "Увеличена ширина модального окна до 98% экрана",
                            "Первые 3 колонки (Метод, Субагент, ID) теперь фиксированы при горизонтальной прокрутке",
                            "Заголовки колонок теперь переносятся на новую строку и отображаются полностью",
                            "Исправлены названия '% Времени работы на пополнения/вывод' - теперь полные",
                            "Оптимизированы размеры шрифтов и отступов для лучшей читаемости",
                            "Горизонтальная прокрутка для просмотра всех 24 колонок"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.10",
                "date": "2025-11-05",
                "title": "Добавление процентов времени работы",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "2 новых поля в ручных данных (в начале списка): % Времени работы на пополнения, % Времени работы на вывод",
                            "Ручной ввод процентов (без кнопок +/-)",
                            "2 новые колонки в детальном отчете с процентами времени"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Визуальная метка '%' рядом с полем ввода"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.9",
                "date": "2025-11-05",
                "title": "Шаг 5: Ручное заполнение данных",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Добавлен 5-й шаг в аналитику 'Ручные данные' (обязательный)",
                            "Выпадающий список партнеров с быстрым поиском по полю 'Субагент'",
                            "8 новых полей для ручного заполнения: Отключение по предоплате, Игнорирование чатов, Игнор Webmanagement, Очереди на пополнение, Очереди на вывод, Зачисление вне лимитов, Одобрение неверной суммы, Другие нарушения",
                            "Кнопки +/- для удобного редактирования значений",
                            "Возможность ввода числа вручную",
                            "Автосохранение данных при изменении",
                            "8 новых колонок в детальном отчете с ручными данными"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Табличное отображение ручных данных",
                            "Живой поиск партнеров при вводе текста",
                            "Интуитивные кнопки увеличения/уменьшения значений"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.8",
                "date": "2025-11-05",
                "title": "Добавление данных контроля качества в отчет",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "6 новых колонок в детальном отчете: Кол-во пополнений, Кол-во выводов, Обращений по пополнениям, Обращения 15+ мин, % успешных пополнений, % успешных выводов",
                            "Автоматическая загрузка данных из файла 'Контроль качества работы' на шаге 3",
                            "Поиск данных по колонке 'ID cубагента' и сопоставление с субагентами из системы",
                            "Конвертация процентов из формата 0.89 в 89%"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Поиск колонок теперь происходит по точным названиям заголовков",
                            "Добавлена подробная документация к функции parseQualityControlData"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.1",
                "date": "2025-11-04",
                "title": "Добавлена вкладка 'Отчет' в модуль Расчет трафика",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Третья вкладка 'Отчет' для формирования итогового отчета",
                            "Кнопка 'Сформировать отчет' на основе данных из аналитики",
                            "Автоматическая статистика: всего субагентов, новых, старых, закрытых",
                            "Краткая таблица с отображением только названий субагентов",
                            "Кнопка 'Подробнее' для открытия детального отчета",
                            "Модальное окно с полной таблицей: Метод, Субагент, Субагент ID, Статус, Дата"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Статистические карточки с подсчетом по статусам",
                            "Увеличенное модальное окно для детального просмотра",
                            "Плейсхолдер с подсказкой при отсутствии отчета"
                        ]
                    }
                ]
            },
            {
                "version": "1.2.0",
                "date": "2025-11-04",
                "title": "Новый модуль: Расчет трафика",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Создан модуль 'Расчет трафика' для управления партнерами и аналитики",
                            "Добавление партнеров с полями: Метод, Субагент, Субагент ID",
                            "Редактируемый список методов с возможностью добавления/удаления",
                            "Автоматические флаги статуса: 'новый', 'старый', 'закрыт'",
                            "Автоматическое изменение статуса 'новый' → 'старый' через 30 дней",
                            "Табличное отображение партнеров с фильтрацией по методам",
                            "Подсчет количества субагентов с фильтром по методам",
                            "Аналитическая панель с выбором партнеров: Все / По методу / Выборочно",
                            "Предпросмотр выбранных партнеров в табличном виде",
                            "Сохранение данных в localStorage"
                        ]
                    },
                    {
                        "category": "Интерфейс",
                        "items": [
                            "Две вкладки: 'Управление партнерами' и 'Аналитика'",
                            "Модальные окна для редактирования партнеров и управления методами",
                            "Интеграция в главное меню и рабочий стол Windows XP",
                            "Адаптивный дизайн для мобильных устройств"
                        ]
                    }
                ]
            },
            {
                "version": "1.1.3",
                "date": "2025-10-27",
                "title": "Оптимизация загрузки Lucide Icons",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Исправлены 302 редиректы при загрузке Lucide Icons",
                            "Заменен lucide@latest на конкретную версию lucide@0.548.0 во всех модулях",
                            "Улучшена производительность загрузки - прямая загрузка без редиректов",
                            "Исправлены файлы: index.html, documentation/index.html, excel-reports/index.html, team-info/index.html"
                        ]
                    }
                ]
            },
            {
                "version": "1.1.2",
                "date": "2025-10-27",
                "title": "Исправление ошибки CSS селектора",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Устранена ошибка CSS 'Набор правил проигнорирован из-за плохого селектора' во всех модулях",
                            "Удален невалидный селектор ::-webkit-scrollbar-thumb:hover из файлов xp-style.css, main.css и xp-module.css",
                            "Псевдоэлементы не могут использовать псевдоклассы состояния - исправлено согласно спецификации CSS",
                            "Исправлены CSS файлы: главная страница, модульные страницы и XP-стили"
                        ]
                    }
                ]
            },
            {
                "version": "1.1.1",
                "date": "2025-10-27",
                "title": "Исправление отображения и валидации полей",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Множественные значения теперь отображаются полностью на карточках (раньше показывалось только первое значение)",
                            "Числовые и денежные поля теперь блокируют ввод букв и спецсимволов",
                            "Добавлена валидация ввода: только цифры, точка и минус для чисел",
                            "Улучшен пользовательский опыт при работе с числовыми полями"
                        ]
                    }
                ]
            },
            {
                "version": "1.1.0",
                "date": "2025-10-27",
                "title": "Типизированные поля с множественными значениями",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "5 типов полей: Общее, Дата, Числовой, Денежный, E-mail",
                            "Календарь для выбора даты (формат ДД/ММ/ГГГГ)",
                            "Валидация email (обязательно @)",
                            "Выбор валюты для денежных полей (RUB, EUR)",
                            "До 3 значений в одном поле",
                            "Кнопка '+ Значение' для добавления значений",
                            "Автоматическое форматирование даты при сохранении"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Новый UI для добавления кастомных полей",
                            "Динамическое изменение инпутов при смене типа поля",
                            "Валидация данных перед сохранением",
                            "Поддержка обратной совместимости со старыми данными"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.10",
                "date": "2025-10-27",
                "title": "Исправление переключения скрытых полей",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Функция revealField() теперь переключает между 'скрыто' и значением",
                            "Убраны звездочки - теперь только 'скрыто' или реальное значение"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.9",
                "date": "2025-10-27",
                "title": "Исправление конфликта с глобальным CSS",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Найден конфликт с глобальным правилом .hidden { display: none !important }",
                            "Класс .hidden заменен на .field-concealed для скрытых полей",
                            "Скрытые поля теперь отображаются корректно"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.8",
                "date": "2025-10-27",
                "title": "Исправление отображения скрытых полей",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Добавлен явный цвет для текста 'скрыто' в CSS",
                            "Скрытые поля теперь отображаются курсивом серым цветом",
                            "Добавлены детальные логи генерации HTML для отладки"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.7",
                "date": "2025-10-27",
                "title": "Улучшение отображения карточек",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "В свернутом виде: ФИО, должность/грейд, 5 обязательных полей",
                            "Кастомные поля и комментарий только после 'Подробнее'",
                            "Скрытые поля теперь показывают 'скрыто' вместо точек",
                            "Кнопка 'Подробнее' появляется при наличии кастомных полей или комментария"
                        ]
                    },
                    {
                        "category": "Исправлено",
                        "items": [
                            "Добавлены логи для отладки отображения скрытых полей",
                            "Копирование в буфер добавлено для видимых кастомных полей"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.6",
                "date": "2025-10-27",
                "title": "Обновление Team Info",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Отдельные поля для ФИО, должности и грейда",
                            "5 обязательных полей: Логин УРС, Reddy, Корп. e-mail, Корп. Telegram, Корп. телефон",
                            "Возможность добавления кастомных полей кроме обязательных",
                            "Копирование значений полей в буфер при клике",
                            "Выбор грейда (Junior/Middle/Senior)"
                        ]
                    },
                    {
                        "category": "Изменено",
                        "items": [
                            "Заголовок карточки теперь только ФИО",
                            "Под заголовком отображается должность и грейд",
                            "Обязательные поля всегда видны в неразвернутом виде",
                            "Кастомные поля - первые 3 в свернутом виде, все в развернутом"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.5",
                "date": "2025-10-27",
                "title": "Очистка кода",
                "changes": [
                    {
                        "category": "Удалено",
                        "items": [
                            "Экспорт в PDF (функция не работала корректно)",
                            "Удалены все связанные библиотеки и скрипты",
                            "Упрощен интерфейс документации"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Ускорена загрузка страницы документации",
                            "Убраны неиспользуемые зависимости"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.3",
                "date": "2025-10-23",
                "title": "Упрощение документации",
                "changes": [
                    {
                        "category": "Изменено",
                        "items": [
                            "Документация теперь только для просмотра",
                            "Улучшено форматирование и структура"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.2",
                "date": "2025-10-22",
                "title": "Обновление документации",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Дерево обновлений для отслеживания изменений",
                            "Кнопка просмотра истории обновлений"
                        ]
                    },
                    {
                        "category": "Улучшено",
                        "items": [
                            "Документация стала короче и понятнее",
                            "Убраны несуществующие ссылки на GitHub",
                            "Улучшено описание функционала"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.1",
                "date": "2025-10-22",
                "title": "Исправления UI",
                "changes": [
                    {
                        "category": "Исправлено",
                        "items": [
                            "Кнопка экспорта в Team Info теперь сохраняет размер при клике",
                            "Иконки Lucide правильно отображаются при переключении меню"
                        ]
                    }
                ]
            },
            {
                "version": "1.0.0",
                "date": "2025-10-22",
                "title": "Первый релиз",
                "changes": [
                    {
                        "category": "Новое",
                        "items": [
                            "Главная страница с интерфейсом Windows XP",
                            "Team Info - управление командой",
                            "Excel Reports - обработка отчётов",
                            "Документация"
                        ]
                    }
                ]
            }
        ]
    },
    
    selectedVersionIndex: 0,
    searchQuery: '',

    show() {
        const dataToUse = this.data || this.fallbackData;

        if (!dataToUse) {
            alert('Не удалось загрузить историю обновлений');
            return;
        }

        this.selectedVersionIndex = 0;
        this.searchQuery = '';

        const modal = document.createElement('div');
        modal.className = 'changelog-modal';
        modal.id = 'changelogModal';
        modal.innerHTML = `
            <div class="changelog-dialog changelog-dialog-split">
                <div class="changelog-header">
                    <h2>История обновлений</h2>
                    <div class="changelog-search">
                        <input type="text" id="changelogSearch" placeholder="Поиск по версии или названию..." />
                    </div>
                    <button class="changelog-close" onclick="this.closest('.changelog-modal').remove()">×</button>
                </div>
                <div class="changelog-body-split">
                    <div class="changelog-versions-list" id="versionsList">
                        ${this.renderVersionsList()}
                    </div>
                    <div class="changelog-version-detail" id="versionDetail">
                        ${this.renderVersionDetail(0)}
                    </div>
                </div>
            </div>
        `;

        document.body.appendChild(modal);

        // Поиск
        const searchInput = document.getElementById('changelogSearch');
        searchInput.addEventListener('input', (e) => {
            this.searchQuery = e.target.value.toLowerCase();
            document.getElementById('versionsList').innerHTML = this.renderVersionsList();
            this.attachVersionClickHandlers();
        });

        this.attachVersionClickHandlers();

        // Закрытие по клику вне диалога
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                modal.remove();
            }
        });

        // Закрытие по Escape
        const handleEscape = (e) => {
            if (e.key === 'Escape') {
                modal.remove();
                document.removeEventListener('keydown', handleEscape);
            }
        };
        document.addEventListener('keydown', handleEscape);
    },

    attachVersionClickHandlers() {
        document.querySelectorAll('.version-list-item').forEach(item => {
            item.addEventListener('click', () => {
                const index = parseInt(item.dataset.index);
                this.selectedVersionIndex = index;

                // Обновить активный элемент
                document.querySelectorAll('.version-list-item').forEach(el => el.classList.remove('active'));
                item.classList.add('active');

                // Обновить детали
                document.getElementById('versionDetail').innerHTML = this.renderVersionDetail(index);
            });
        });
    },

    renderVersionsList() {
        const dataToUse = this.data || this.fallbackData;
        const updates = dataToUse.updates.filter(update => {
            if (!this.searchQuery) return true;
            return update.version.toLowerCase().includes(this.searchQuery) ||
                   update.title.toLowerCase().includes(this.searchQuery);
        });

        if (updates.length === 0) {
            return '<div class="no-results">Ничего не найдено</div>';
        }

        return updates.map((update, filteredIndex) => {
            const realIndex = dataToUse.updates.indexOf(update);
            const isLatest = realIndex === 0;
            const isActive = realIndex === this.selectedVersionIndex;

            return `
                <div class="version-list-item ${isActive ? 'active' : ''} ${isLatest ? 'latest' : ''}" data-index="${realIndex}">
                    <div class="version-list-header">
                        <span class="version-list-number">v${update.version}</span>
                        ${isLatest ? '<span class="version-list-badge">NEW</span>' : ''}
                    </div>
                    <div class="version-list-title">${update.title}</div>
                    <div class="version-list-date">${Utils.formatDate(update.date)}</div>
                </div>
            `;
        }).join('');
    },

    renderVersionDetail(index) {
        const dataToUse = this.data || this.fallbackData;
        const update = dataToUse.updates[index];

        if (!update) {
            return '<div class="no-version-selected">Выберите версию из списка</div>';
        }

        const isLatest = index === 0;

        return `
            <div class="changelog-detail-header">
                <div class="changelog-version">
                    <span class="version-number">v${update.version}</span>
                    ${isLatest ? '<span class="version-badge">Latest</span>' : ''}
                </div>
                <div class="changelog-date">${Utils.formatDate(update.date)}</div>
            </div>
            <h3 class="changelog-title">${update.title}</h3>
            <div class="changelog-changes-list">
                ${update.changes.map(change => this.renderChanges(change)).join('')}
            </div>
        `;
    },

    // Legacy метод для совместимости
    renderTimeline() {
        const dataToUse = this.data || this.fallbackData;
        return `
            <div class="changelog-timeline">
                ${dataToUse.updates.map((update, index) => this.renderUpdate(update, index)).join('')}
            </div>
        `;
    },

    renderUpdate(update, index) {
        const dataToUse = this.data || this.fallbackData;
        const isLatest = index === 0;

        return `
            <div class="changelog-item ${isLatest ? 'latest' : ''}">
                <div class="changelog-marker">
                    <div class="changelog-dot"></div>
                    ${index < dataToUse.updates.length - 1 ? '<div class="changelog-line"></div>' : ''}
                </div>
                <div class="changelog-content">
                    <div class="changelog-version">
                        <span class="version-number">v${update.version}</span>
                        ${isLatest ? '<span class="version-badge">Latest</span>' : ''}
                    </div>
                    <div class="changelog-date">${Utils.formatDate(update.date)}</div>
                    <h3 class="changelog-title">${update.title}</h3>
                    ${update.changes.map(change => this.renderChanges(change)).join('')}
                </div>
            </div>
        `;
    },
    
    renderChanges(change) {
        const categoryStyles = {
            'Новое': { symbol: '+', color: '#4caf50' },
            'Исправлено': { symbol: '✓', color: '#2196f3' },
            'Улучшено': { symbol: '⚡', color: '#ff9800' },
            'Удалено': { symbol: '−', color: '#f44336' },
            'Изменено': { symbol: '✎', color: '#9c27b0' },
            'Интерфейс': { symbol: '▣', color: '#00bcd4' },
            'Безопасность': { symbol: '🔒', color: '#e91e63' },
            'Бэкенд': { symbol: '⚙', color: '#607d8b' },
            'Файлы': { symbol: '📁', color: '#795548' }
        };

        const style = categoryStyles[change.category] || { symbol: '•', color: '#666' };

        return `
            <div class="changelog-category">
                <h4 style="color: ${style.color};">
                    <span style="margin-right: 6px;">${style.symbol}</span>${change.category}
                </h4>
                <ul class="changelog-list">
                    ${change.items.map(item => `<li>${item}</li>`).join('')}
                </ul>
            </div>
        `;
    }
};

// Инициализация при загрузке страницы
document.addEventListener('DOMContentLoaded', async () => {
    await changelog.init();
});

console.log('✅ Changelog готов к использованию');
