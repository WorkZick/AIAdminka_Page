<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; connect-src 'self' https://script.google.com https://script.googleusercontent.com https://accounts.google.com https://www.googleapis.com; frame-ancestors 'self'">
    <title>Настройки - AIAdminka</title>
    <link rel="stylesheet" href="css/sync.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <button class="back-button" onclick="settingsApp.toggleSidebar()">
                <img src="icons/arrow.svg" width="30" height="30" alt="Toggle">
            </button>

            <div class="sidebar-menu">
                <div class="menu-item" onclick="window.location.href='../index.html'">
                    <span>Главная</span>
                    <img src="icons/main_page.svg" width="20" height="20" alt="Главная">
                </div>

                <div class="menu-item" onclick="window.location.href='../excel-reports/index.html'">
                    <span>Отчеты</span>
                    <img src="icons/excel_reports.svg" width="20" height="20" alt="Отчеты">
                </div>

                <div class="menu-item" onclick="window.location.href='../team-info/index.html'">
                    <span>Сотрудники</span>
                    <img src="icons/team_info.svg" width="20" height="20" alt="Сотрудники">
                </div>

                <div class="menu-item" onclick="window.location.href='../traffic-calculation/index.html'">
                    <span>Расчет трафика</span>
                    <img src="icons/Traffic calculation.svg" width="20" height="20" alt="Трафик">
                </div>

                <div class="menu-item" onclick="window.location.href='../partners/index.html'">
                    <span>Партнеры</span>
                    <img src="icons/partners.svg" width="20" height="20" alt="Партнеры">
                </div>

                <div class="menu-item" onclick="window.location.href='../documentation/index.html'">
                    <span>Документация</span>
                    <img src="icons/documents.svg" width="20" height="20" alt="Документация">
                </div>

                <div class="menu-item active">
                    <span>Настройки</span>
                    <img src="icons/sync.svg" width="20" height="20" alt="Настройки">
                </div>
            </div>

            <div class="menu-separator"></div>

            <div class="version-info" onclick="showAboutModal()">
                <span class="version-text-full">О разработке</span>
                <span id="versionText" class="version-number"></span>
                <span class="version-icon" title="О разработке">
                    <img src="../shared/icons/info.svg" alt="О разработке">
                </span>
            </div>
        </aside>

        <script>
            (function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('no-transition');
                if (localStorage.getItem('sidebar-collapsed') === 'true') {
                    sidebar.classList.add('collapsed');
                }
                requestAnimationFrame(function() {
                    requestAnimationFrame(function() {
                        sidebar.classList.remove('no-transition');
                    });
                });
            })();
        </script>

        <!-- Main wrapper -->
        <div class="main-wrapper">
            <!-- Global header -->
            <header class="global-header">
                <div class="header-title">Настройки</div>
                <div class="header-status" id="connectionStatus">
                    <span class="status-dot"></span>
                    <span class="status-text">Подключено</span>
                </div>
            </header>

            <!-- Content area -->
            <div class="content-area">
                <!-- Main section -->
                <main class="main-section settings-layout">

                    <!-- Account Section -->
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                            </div>
                            <span>Аккаунт</span>
                        </div>
                        <div class="card-content">
                            <div class="user-profile" id="userProfile">
                                <div class="user-avatar" id="userAvatar"></div>
                                <div class="user-details">
                                    <div class="user-name" id="userName">-</div>
                                    <div class="user-email" id="userEmail">-</div>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn-logout" onclick="settingsApp.logout()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16,17 21,12 16,7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                                    Выйти из аккаунта
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Cloud Storage Section -->
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"/>
                                </svg>
                            </div>
                            <span>Облачное хранилище</span>
                        </div>
                        <div class="card-content">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Статус</span>
                                    <span class="info-value status-ok" id="storageStatus">Подключено</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Тип хранилища</span>
                                    <span class="info-value">Google Sheets</span>
                                </div>
                            </div>
                            <p class="info-text">
                                Данные партнёров, шаблоны и методы автоматически синхронизируются с облаком.
                            </p>
                        </div>
                    </div>

                    <!-- Local Data Section -->
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="17,8 12,3 7,8"/>
                                    <line x1="12" y1="3" x2="12" y2="15"/>
                                </svg>
                            </div>
                            <span>Локальные данные</span>
                        </div>
                        <div class="card-content">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Настройки интерфейса</span>
                                    <span class="info-value" id="localSettingsSize">-</span>
                                </div>
                                <div class="info-item">
                                    <span class="info-label">Кэш данных</span>
                                    <span class="info-value" id="localCacheSize">-</span>
                                </div>
                            </div>
                            <div class="card-actions">
                                <button class="btn-secondary" onclick="settingsApp.clearCache()">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3,6 5,6 21,6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                    Очистить кэш
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Session Info Section -->
                    <div class="settings-card">
                        <div class="card-header">
                            <div class="card-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12,6 12,12 16,14"/>
                                </svg>
                            </div>
                            <span>Сессия</span>
                        </div>
                        <div class="card-content">
                            <div class="info-grid">
                                <div class="info-item">
                                    <span class="info-label">Авторизация действует до</span>
                                    <span class="info-value" id="sessionExpiry">-</span>
                                </div>
                            </div>
                            <p class="info-text">
                                Сессия автоматически продлевается при использовании системы.
                            </p>
                        </div>
                    </div>

                </main>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div class="modal" id="aboutModal">
        <div class="modal-dialog">
            <div class="modal-header">
                <h2 class="modal-title">О разработке</h2>
                <button class="modal-close" onclick="closeAboutModal()">
                    <img src="icons/cross.svg" width="24" height="24" alt="Закрыть">
                </button>
            </div>
            <div class="modal-body">
                <p>Это проект <strong>Vadim P</strong></p>
                <p>Reddy ID для связи: <strong>62219492522</strong></p>
                <p>Ссылка на чат с актуальной версией:<br>
                <a href="https://lnk.reddy.team/invite/sp9ugcdOP7mIzmLSWZNocYCffj5enUB_" target="_blank">https://lnk.reddy.team/invite/sp9ugcdOP7mIzmLSWZNocYCffj5enUB_</a></p>
            </div>
        </div>
    </div>

    <!-- Confirm Logout Modal -->
    <div class="modal" id="logoutModal">
        <div class="modal-dialog modal-sm">
            <div class="modal-header">
                <h2 class="modal-title">Выход из аккаунта</h2>
                <button class="modal-close" onclick="settingsApp.closeModal('logoutModal')">
                    <img src="icons/cross.svg" width="24" height="24" alt="Закрыть">
                </button>
            </div>
            <div class="modal-body">
                <p>Вы уверены, что хотите выйти из аккаунта?</p>
                <p class="text-muted">Вам потребуется повторная авторизация через Google.</p>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" onclick="settingsApp.closeModal('logoutModal')">Отмена</button>
                <button class="btn-danger" onclick="settingsApp.confirmLogout()">Выйти</button>
            </div>
        </div>
    </div>

    <script src="../shared/version.js"></script>
    <script src="../shared/cloud-storage.js"></script>
    <script src="../shared/sync-manager.js"></script>
    <script src="../shared/auth-guard.js"></script>
    <script src="js/settings.js"></script>
    <script>
        function showAboutModal() {
            document.getElementById('aboutModal').classList.add('active');
        }
        function closeAboutModal() {
            document.getElementById('aboutModal').classList.remove('active');
        }
        document.getElementById('aboutModal').addEventListener('click', function(e) {
            if (e.target === this) closeAboutModal();
        });
    </script>
</body>
</html>
